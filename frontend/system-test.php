<?php
require_once '../backend/config/config.php';
require_once '../backend/config/database.php';
require_once '../backend/includes/functions.php';

// Check if user is logged in
if (!is_logged_in()) {
    redirect('/index.php');
}

$user = get_current_user_data();
?>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Testi - Celestial Tale</title>
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    <link rel="stylesheet" href="assets/css/mobile.css">
    <link rel="stylesheet" href="assets/css/main-menu.css">
    <link rel="stylesheet" href="assets/css/enhanced-features.css">
</head>
<body>
    <div class="starfield"></div>
    <div class="nebula"></div>
    
    <main class="main-container">
        <div class="content-container">
            <!-- System Test Header -->
            <div class="page-header">
                <div class="header-content">
                    <div class="header-icon">üß™</div>
                    <div class="header-info">
                        <h1 class="page-title">Sistem Entegrasyon Testi</h1>
                        <p class="page-description">T√ºm yeni √∂zelliklerin test edilmesi</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="tests-passed">0</span>
                        <span class="stat-label">Ba≈üarƒ±lƒ±</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="tests-total">12</span>
                        <span class="stat-label">Toplam Test</span>
                    </div>
                </div>
            </div>

            <!-- Test Categories -->
            <div class="test-categories">
                
                <!-- Audio System Tests -->
                <div class="test-category">
                    <h2 class="section-title">üéµ Ses Sistemi Testleri</h2>
                    <div class="test-grid">
                        <div class="test-item" id="test-audio-manager">
                            <div class="test-icon">üéß</div>
                            <div class="test-info">
                                <h3 class="test-name">Audio Manager</h3>
                                <p class="test-description">Ses y√∂neticisinin y√ºklenmesi</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testAudioManager()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-sound-effects">
                            <div class="test-icon">üîä</div>
                            <div class="test-info">
                                <h3 class="test-name">Ses Efektleri</h3>
                                <p class="test-description">Hover ve click seslerinin √ßalƒ±≈ümasƒ±</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testSoundEffects()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-background-music">
                            <div class="test-icon">üéµ</div>
                            <div class="test-info">
                                <h3 class="test-name">Background M√ºzik</h3>
                                <p class="test-description">Arka plan m√ºziƒüi kontrol√º</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testBackgroundMusic()">Test Et</button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tests -->
                <div class="test-category">
                    <h2 class="section-title">üß≠ Navigasyon Testleri</h2>
                    <div class="test-grid">
                        <div class="test-item" id="test-ajax-loading">
                            <div class="test-icon">‚ö°</div>
                            <div class="test-info">
                                <h3 class="test-name">AJAX Y√ºkleme</h3>
                                <p class="test-description">Sayfa i√ßi i√ßerik y√ºkleme</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testAjaxLoading()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-submenu-system">
                            <div class="test-icon">üìã</div>
                            <div class="test-info">
                                <h3 class="test-name">Alt Men√º Sistemi</h3>
                                <p class="test-description">Geni≈ületilebilir men√ºlerin √ßalƒ±≈ümasƒ±</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testSubmenuSystem()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-profile-interaction">
                            <div class="test-icon">üë§</div>
                            <div class="test-info">
                                <h3 class="test-name">Profil Etkile≈üimi</h3>
                                <p class="test-description">Profil avatar ve stats tƒ±klama</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testProfileInteraction()">Test Et</button>
                        </div>
                    </div>
                </div>

                <!-- Feature Tests -->
                <div class="test-category">
                    <h2 class="section-title">‚ú® √ñzellik Testleri</h2>
                    <div class="test-grid">
                        <div class="test-item" id="test-collection-pages">
                            <div class="test-icon">üìö</div>
                            <div class="test-info">
                                <h3 class="test-name">Koleksiyon Sayfalarƒ±</h3>
                                <p class="test-description">Gallery, Audio, Bonus Stories</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testCollectionPages()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-events-system">
                            <div class="test-icon">üéâ</div>
                            <div class="test-info">
                                <h3 class="test-name">Etkinlik Sistemi</h3>
                                <p class="test-description">Daily routines, Special events</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testEventsSystem()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-premium-features">
                            <div class="test-icon">üëë</div>
                            <div class="test-info">
                                <h3 class="test-name">Premium √ñzellikler</h3>
                                <p class="test-description">VIP packages, Premium content</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testPremiumFeatures()">Test Et</button>
                        </div>
                    </div>
                </div>

                <!-- Responsive Tests -->
                <div class="test-category">
                    <h2 class="section-title">üì± Responsive Testleri</h2>
                    <div class="test-grid">
                        <div class="test-item" id="test-mobile-layout">
                            <div class="test-icon">üì±</div>
                            <div class="test-info">
                                <h3 class="test-name">Mobil Layout</h3>
                                <p class="test-description">Mobil cihazlarda g√∂r√ºn√ºm</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testMobileLayout()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-touch-interactions">
                            <div class="test-icon">üëÜ</div>
                            <div class="test-info">
                                <h3 class="test-name">Touch Etkile≈üimleri</h3>
                                <p class="test-description">Dokunmatik kontroller</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testTouchInteractions()">Test Et</button>
                        </div>
                        
                        <div class="test-item" id="test-performance">
                            <div class="test-icon">‚ö°</div>
                            <div class="test-info">
                                <h3 class="test-name">Performans</h3>
                                <p class="test-description">Y√ºkleme hƒ±zƒ± ve animasyonlar</p>
                            </div>
                            <div class="test-status pending">‚è≥</div>
                            <button class="test-btn" onclick="testPerformance()">Test Et</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Results -->
            <div class="test-results">
                <h2 class="section-title">üìä Test Sonu√ßlarƒ±</h2>
                <div class="results-summary">
                    <div class="summary-item">
                        <div class="summary-icon">‚úÖ</div>
                        <div class="summary-info">
                            <div class="summary-value" id="passed-count">0</div>
                            <div class="summary-label">Ba≈üarƒ±lƒ±</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">‚ùå</div>
                        <div class="summary-info">
                            <div class="summary-value" id="failed-count">0</div>
                            <div class="summary-label">Ba≈üarƒ±sƒ±z</div>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">‚è≥</div>
                        <div class="summary-info">
                            <div class="summary-value" id="pending-count">12</div>
                            <div class="summary-label">Bekleyen</div>
                        </div>
                    </div>
                </div>
                
                <div class="test-actions">
                    <button class="btn secondary" onclick="runAllTests()">
                        <span class="btn-icon">üöÄ</span>
                        <span class="btn-text">T√ºm Testleri √áalƒ±≈ütƒ±r</span>
                    </button>
                    <button class="btn primary" onclick="window.location.href='main-menu.php'">
                        <span class="btn-icon">üè†</span>
                        <span class="btn-text">Ana Men√ºye D√∂n</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Background Music Controls -->
    <div class="music-controls">
        <button id="music-toggle" class="music-btn" onclick="toggleBackgroundMusic()" title="M√ºzik A√ß/Kapat">
            <span class="music-icon">üéµ</span>
        </button>
        <div class="volume-control">
            <input type="range" id="music-volume" min="0" max="100" value="50" onchange="setMusicVolume(this.value)">
        </div>
    </div>

    <script src="assets/js/menu-manager.js"></script>
    <script src="assets/js/audio-manager.js"></script>
    <script src="assets/js/main-menu.js"></script>
    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            pending: 12
        };

        function updateTestCounts() {
            document.getElementById('tests-passed').textContent = testResults.passed;
            document.getElementById('passed-count').textContent = testResults.passed;
            document.getElementById('failed-count').textContent = testResults.failed;
            document.getElementById('pending-count').textContent = testResults.pending;
        }

        function setTestResult(testId, success, message = '') {
            const testItem = document.getElementById(testId);
            const statusElement = testItem.querySelector('.test-status');
            
            if (success) {
                statusElement.textContent = '‚úÖ';
                statusElement.className = 'test-status success';
                testResults.passed++;
            } else {
                statusElement.textContent = '‚ùå';
                statusElement.className = 'test-status failed';
                testResults.failed++;
            }
            
            testResults.pending--;
            updateTestCounts();
            
            if (message) {
                showNotification(message);
            }
        }

        // Test Functions
        function testAudioManager() {
            const success = window.audioManager !== undefined;
            setTestResult('test-audio-manager', success, 
                success ? 'Audio Manager ba≈üarƒ±yla y√ºklendi!' : 'Audio Manager y√ºklenemedi!');
        }

        function testSoundEffects() {
            if (window.audioManager) {
                window.audioManager.playSound('click');
                setTimeout(() => window.audioManager.playSound('hover'), 500);
                setTestResult('test-sound-effects', true, 'Ses efektleri test edildi!');
            } else {
                setTestResult('test-sound-effects', false, 'Audio Manager bulunamadƒ±!');
            }
        }

        function testBackgroundMusic() {
            if (window.audioManager) {
                window.audioManager.playMusic();
                setTestResult('test-background-music', true, 'Background m√ºzik ba≈ülatƒ±ldƒ±!');
            } else {
                setTestResult('test-background-music', false, 'Audio Manager bulunamadƒ±!');
            }
        }

        function testAjaxLoading() {
            if (window.menuManager && typeof window.menuManager.loadContent === 'function') {
                setTestResult('test-ajax-loading', true, 'AJAX loading sistemi hazƒ±r!');
            } else {
                setTestResult('test-ajax-loading', false, 'Menu Manager bulunamadƒ±!');
            }
        }

        function testSubmenuSystem() {
            if (window.menuManager && typeof window.menuManager.toggleSubmenu === 'function') {
                setTestResult('test-submenu-system', true, 'Alt men√º sistemi hazƒ±r!');
            } else {
                setTestResult('test-submenu-system', false, 'Menu Manager bulunamadƒ±!');
            }
        }

        function testProfileInteraction() {
            const profileAvatar = document.querySelector('.profile-avatar');
            const profileStats = document.querySelector('.profile-stats');
            const success = profileAvatar && profileStats;
            setTestResult('test-profile-interaction', success, 
                success ? 'Profil etkile≈üimleri hazƒ±r!' : 'Profil elementleri bulunamadƒ±!');
        }

        function testCollectionPages() {
            // Test if collection pages exist
            fetch('gallery.php', { method: 'HEAD' })
                .then(response => {
                    setTestResult('test-collection-pages', response.ok, 
                        response.ok ? 'Koleksiyon sayfalarƒ± hazƒ±r!' : 'Koleksiyon sayfalarƒ± bulunamadƒ±!');
                })
                .catch(() => {
                    setTestResult('test-collection-pages', false, 'Koleksiyon sayfalarƒ± test edilemedi!');
                });
        }

        function testEventsSystem() {
            fetch('daily-routines.php', { method: 'HEAD' })
                .then(response => {
                    setTestResult('test-events-system', response.ok, 
                        response.ok ? 'Etkinlik sistemi hazƒ±r!' : 'Etkinlik sayfalarƒ± bulunamadƒ±!');
                })
                .catch(() => {
                    setTestResult('test-events-system', false, 'Etkinlik sistemi test edilemedi!');
                });
        }

        function testPremiumFeatures() {
            fetch('vip-packages.php', { method: 'HEAD' })
                .then(response => {
                    setTestResult('test-premium-features', response.ok, 
                        response.ok ? 'Premium √∂zellikler hazƒ±r!' : 'Premium sayfalarƒ± bulunamadƒ±!');
                })
                .catch(() => {
                    setTestResult('test-premium-features', false, 'Premium √∂zellikler test edilemedi!');
                });
        }

        function testMobileLayout() {
            const isMobile = window.innerWidth <= 768;
            const hasResponsiveCSS = document.querySelector('link[href*="mobile.css"]') !== null;
            setTestResult('test-mobile-layout', hasResponsiveCSS, 
                hasResponsiveCSS ? 'Mobil layout hazƒ±r!' : 'Mobil CSS bulunamadƒ±!');
        }

        function testTouchInteractions() {
            const hasTouchSupport = 'ontouchstart' in window;
            setTestResult('test-touch-interactions', true, 
                hasTouchSupport ? 'Touch desteƒüi mevcut!' : 'Touch desteƒüi yok, ancak test ge√ßti!');
        }

        function testPerformance() {
            const startTime = performance.now();
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                const success = loadTime < 1000; // Less than 1 second
                setTestResult('test-performance', success, 
                    `Performans testi: ${loadTime.toFixed(2)}ms`);
            }, 100);
        }

        function runAllTests() {
            showNotification('T√ºm testler √ßalƒ±≈ütƒ±rƒ±lƒ±yor...');
            
            const tests = [
                testAudioManager,
                testSoundEffects,
                testBackgroundMusic,
                testAjaxLoading,
                testSubmenuSystem,
                testProfileInteraction,
                testCollectionPages,
                testEventsSystem,
                testPremiumFeatures,
                testMobileLayout,
                testTouchInteractions,
                testPerformance
            ];
            
            tests.forEach((test, index) => {
                setTimeout(test, index * 500);
            });
        }

        // Global functions
        function toggleBackgroundMusic() {
            if (window.audioManager) {
                const musicBtn = document.getElementById('music-toggle');
                const musicIcon = musicBtn.querySelector('.music-icon');
                
                if (window.audioManager.music && !window.audioManager.music.paused) {
                    window.audioManager.pauseMusic();
                    musicIcon.textContent = 'üîá';
                } else {
                    window.audioManager.playMusic();
                    musicIcon.textContent = 'üéµ';
                }
            }
        }

        function setMusicVolume(value) {
            if (window.audioManager) {
                window.audioManager.setMusicVolume(value / 100);
            }
        }

        function showNotification(message) {
            if (window.menuManager) {
                window.menuManager.showNotification(message);
            }
        }
    </script>
</body>
</html>
